/* Formatted on 27/04/2024 06:06:58 (QP5 v5.391) */
/* monitoring running scheduler jobs */

SELECT *
  FROM ALL_OBJECTS
 WHERE OBJECT_NAME LIKE '%USER_SCHEDULER_JOB_RUN_DETAILS%';

SELECT *
  FROM ALL_SCHEDULER_JOBS
 WHERE OWNER = 'USERKUR';


  SELECT *
    FROM USER_SCHEDULER_JOB_RUN_DETAILS
ORDER BY LOG_DATE DESC;

  SELECT TO_CHAR (LOG_DATE, 'YYYY/MM/DD HH24:MM:SS') TIMESTAMP,
         OWNER,
         JOB_NAME,
         STATUS,
         SUBSTR (NVL (ADDITIONAL_INFO, '_'), 1, 4000) ADDITIONAL_INFO
    FROM USER_SCHEDULER_JOB_RUN_DETAILS
   WHERE     JOB_NAME LIKE '%JOB_%' /*AND STATUS = 'FAILED'*/
         AND OWNER = 'USERKUR' /*AND JOB_NAME = 'JOB_BANK_WIL'*/
         AND TO_CHAR (LOG_DATE, 'YYYY/MM/DD') <= TO_CHAR (SYSDATE - 1, 'YYYY/MM/DD')
ORDER BY TIMESTAMP DESC;


/* monitoring stored procedure dependencies */

  SELECT A.NAME,
         A.REFERENCED_NAME REF_NAME,
         A.REFERENCED_TYPE REF_TYPE,
         NVL (A.REFERENCED_LINK_NAME, '_') REF_LINK_NAME
    FROM USER_DEPENDENCIES A
   WHERE A.REFERENCED_OWNER = 'USERKUR' AND A.TYPE = 'PROCEDURE'
ORDER BY A.NAME;


  SELECT REF_OWNER, SP_NAME, LISTAGG (REF_NAME, ', ') WITHIN GROUP (ORDER BY REF_NAME) AS REF_TABLE
    FROM (  SELECT A.NAME AS SP_NAME,
                   A.REFERENCED_NAME AS REF_NAME,
                   A.REFERENCED_TYPE AS REF_TYPE,
                   NVL (A.REFERENCED_LINK_NAME, '_') AS REF_LINK_NAME,
                   A.REFERENCED_OWNER AS REF_OWNER
              FROM USER_DEPENDENCIES A
             WHERE A.REFERENCED_OWNER = 'USERKUR' AND A.TYPE = 'PROCEDURE'
          ORDER BY A.NAME)
GROUP BY REF_OWNER, SP_NAME;


  SELECT TO_CHAR (A.LOG_DATE, 'YYYY/MM/DD HH24:MI:SS') AS TIMESTAMP,
         A.JOB_NAME,
         A.STATUS,
         TO_CHAR (A.ACTUAL_START_DATE, 'YYYY/MM/DD HH24:MI:SS') AS ACTUAL_START_DATE,
         A.RUN_DURATION,
         A.ADDITIONAL_INFO,
         A.ERRORS
    FROM ALL_SCHEDULER_JOB_RUN_DETAILS A
   WHERE A.OWNER = 'USERKUR' AND A.STATUS = 'FAILED' AND TO_CHAR (A.LOG_DATE, 'YYMMDD') = TO_CHAR (SYSDATE, 'YYMMDD')
ORDER BY TIMESTAMP DESC;


SELECT *
  FROM ALL_SOURCE
 WHERE OWNER = 'USERKUR' AND TYPE = 'PROCEDURE' AND LOWER (TEXT) LIKE '%kur%';

  SELECT A.JOB_NAME,
         A.JOB_ACTION,
         A.LAST_START_DATE,
         A.LAST_RUN_DURATION,
         A.NEXT_RUN_DATE,
         B.LOG_DATE,
         B.STATUS,
         B.INFO,
         C.REF_NAME
    FROM (SELECT JOB_NAME,
                 --JOB_STYLE,
                 --JOB_CREATOR,
                 --JOB_TYPE,
                 JOB_ACTION,
                 NVL (TO_CHAR (LAST_START_DATE, 'YYYY-MM-DD HH24:MI:SS'), '_') AS LAST_START_DATE,
                 LAST_RUN_DURATION,
                 NVL (TO_CHAR (NEXT_RUN_DATE, 'YYYY-MM-DD HH24:MI:SS'), '_') AS NEXT_RUN_DATE
            FROM USER_SCHEDULER_JOBS) A
         JOIN (  SELECT TO_CHAR (LOG_DATE, 'YYYY-MM-DD HH24:MM:SS') AS LOG_DATE,
                        JOB_NAME,
                        STATUS,
                        SUBSTR (NVL (ADDITIONAL_INFO, '_'), 1, 4000) AS INFO,
                        TO_CHAR (SYSDATE, 'YYYY-MM-DD') AS TODAY
                   FROM USER_SCHEDULER_JOB_RUN_DETAILS
                  WHERE JOB_NAME LIKE '%JOB_%' AND TO_CHAR (LOG_DATE, 'YYYY-MM-DD') = TO_CHAR (SYSDATE - 1, 'YYYY-MM-DD')
               --AND STATUS = 'FAILED'
               ORDER BY LOG_DATE DESC) B
             ON (A.JOB_NAME = B.JOB_NAME)
         JOIN (  SELECT REF_OWNER || '.' || NAME AS PROC_NAME, LISTAGG (REF_NAME, ', ') WITHIN GROUP (ORDER BY REF_NAME) REF_NAME
                   FROM (  SELECT A.NAME,
                                  A.REFERENCED_NAME AS REF_NAME,
                                  A.REFERENCED_TYPE AS REF_TYPE,
                                  NVL (A.REFERENCED_LINK_NAME, '_') AS REF_LINK_NAME,
                                  REFERENCED_OWNER AS REF_OWNER
                             FROM USER_DEPENDENCIES A
                            WHERE A.REFERENCED_OWNER = 'USERKUR' AND A.TYPE = 'PROCEDURE'
                         ORDER BY A.NAME)
               GROUP BY REF_OWNER || '.' || NAME) C
             ON (A.JOB_ACTION = C.PROC_NAME)
ORDER BY LAST_START_DATE DESC;


  SELECT REF_OWNER || '.' || NAME AS PROC_NAME, LISTAGG (REF_NAME, ', ') WITHIN GROUP (ORDER BY REF_NAME) REF_NAME
    FROM (  SELECT A.NAME,
                   A.REFERENCED_NAME AS REF_NAME,
                   A.REFERENCED_TYPE AS REF_TYPE,
                   NVL (A.REFERENCED_LINK_NAME, '_') AS REF_LINK_NAME,
                   REFERENCED_OWNER AS REF_OWNER
              FROM USER_DEPENDENCIES A
             WHERE A.REFERENCED_OWNER = 'USERKUR' AND A.TYPE = 'PROCEDURE'
          ORDER BY A.NAME)
GROUP BY REF_OWNER || '.' || NAME;


SELECT *
  FROM ALL_SOURCE
 WHERE OWNER = 'USERKUR' AND TYPE = 'PROCEDURE' AND LOWER (TEXT) LIKE '%kur%';

  SELECT OWNER,
         JOB_NAME,
         JOB_STYLE,
         JOB_TYPE,
         PROGRAM_NAME,
         JOB_ACTION,
         START_DATE,
         REPEAT_INTERVAL,
         SCHEDULE_NAME,
         LAST_START_DATE,
         NEXT_RUN_DATE,
         STATE
    FROM ALL_SCHEDULER_JOBS /*
   WHERE     NEXT_RUN_DATE >= TRUNC (SYSDATE) + INTERVAL '27' HOUR
         AND NEXT_RUN_DATE < TRUNC (SYSDATE) + INTERVAL '29' HOUR*/
ORDER BY OWNER, JOB_NAME;


  SELECT A.NAME,
         A.REFERENCED_OWNER,
         --A.REFERENCED_NAME,
         A.REFERENCED_TYPE,
         B.TABLE_NAME
    FROM ALL_DEPENDENCIES A JOIN ALL_SYNONYMS B ON (A.REFERENCED_NAME = B.SYNONYM_NAME AND A.REFERENCED_OWNER = B.TABLE_OWNER)
   WHERE REFERENCED_OWNER = 'USERKUR'
ORDER BY 1 ASC, 4 ASC;


  SELECT A.NAME,
         A.REFERENCED_NAME AS REF_NAME,
         A.REFERENCED_TYPE AS REF_TYPE,
         NVL (A.REFERENCED_LINK_NAME, '_') AS REF_LINK_NAME
    FROM USER_DEPENDENCIES A
   WHERE A.REFERENCED_OWNER = 'USERKUR' AND A.TYPE = 'PROCEDURE'
ORDER BY A.NAME;


SELECT JOB_NAME,
       --JOB_STYLE,
       --JOB_CREATOR,
       --JOB_TYPE,
       JOB_ACTION,
       NVL (TO_CHAR (LAST_START_DATE, 'YYYY-MM-DD HH24:MI:SS'), '_') AS LAST_START_DATE,
       LAST_RUN_DURATION,
       NVL (TO_CHAR (NEXT_RUN_DATE, 'YYYY-MM-DD HH24:MI:SS'), '_') AS NEXT_RUN_DATE
  FROM USER_SCHEDULER_JOBS;